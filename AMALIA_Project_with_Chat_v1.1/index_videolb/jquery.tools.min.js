/*!
 * jQuery Tools dev - The missing UI library for the Web
 *
 * overlay/overlay.js
 * overlay/overlay.apple.js
 *
 * NO COPYRIGHTS OR LICENSES. DO WHAT YOU LIKE.
 *
 * http://flowplayer.org/tools/
 * version 1.2.8-dev_c7a9f26148
 * fixed by videolightbox.com: no migrate use
 * fixed by videolightbox.com 13/08/2013: added autoFit/resposive
*
*
*
* 08/05/2014 - Fixed bug with non-removable video after closing overlay
* changes in overlay.apple.js
	if (!o && /url\(/.test(n)) {
		...
		n = n.slice(n.indexOf("(") + 1, n.indexOf(")")).replace(/\"/g, "");
		m.css("backgroundImage", "none");
		o = e('<img src="' + n + '"/>');
		...
	}

	changed to
	if (!o) {
		...
		if(/url\(/.test(n)) {
		    n = n.slice(n.indexOf("(") + 1, n.indexOf(")")).replace(/\"/g, "");
		    m.css("backgroundImage", "none");
			o = e('<img src="' + n + '"/>')
		} else {
			o = e('<div>')
		}
		...
	}
*/
(function(c){c.tools=c.tools||{version:"@VERSION"};c.tools.overlay={addEffect:function(e,f,g){b[e]=[f,g]},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!document.all||window.XMLHttpRequest,left:"center",autoFit:true,load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var d=[],b={};c.tools.overlay.addEffect("default",function(h,g){var f=this.getConf(),e=c(window);this.getOverlay().css(h).fadeIn(f.speed,g)},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e)});function a(h,m){var p=this,f=h.add(p),o=c(window),k,j,i,e=c.tools.expose&&(m.mask||m.expose),l=Math.random().toString().slice(10);if(e){if(typeof e=="string"){e={color:e}}e.closeOnClick=e.closeOnEsc=false}var g=m.target||h.attr("rel");j=g?c(g):null||h;if(!j.length){throw"Could not find Overlay: "+g}if(h&&h.index(j)==-1){h.click(function(q){p.load(q);return q.preventDefault()})}function n(s,r,q){s=s.split(" ");s[0]=parseFloat(s[0])/r;s[1]=parseFloat(s[1])/q;s[2]=parseFloat(s[2])/r;s[3]=parseFloat(s[3])/q;return s.join("px ")+"px"}c.extend(p,{load:function(r){if(p.isOpened()){return p}var q=b[m.effect];if(!q){throw'Overlay: cannot find effect : "'+m.effect+'"'}if(m.oneInstance){c.each(d,function(){this.close(r)})}r=r||c.Event();r.type="onBeforeLoad";f.trigger(r);if(r.isDefaultPrevented()){return p}i=true;if(e){c(j).expose(e)}q[0].call(p,this.getPos(),function(){if(i){r.type="onLoad";f.trigger(r)}});if(e&&m.closeOnClick){c.mask.getMask().one("click",p.close)}if(m.closeOnClick){c(document).on("click."+l,function(s){if(!c(s.target).parents(j).length){p.close(s)}})}if(m.closeOnEsc){c(document).on("keydown."+l,function(s){if(s.keyCode==27){p.close(s)}})}if(m.autoFit){c(window).on("resize scroll",p.putOverlay)}return p},close:function(q){if(!p.isOpened()){return p}q=q||c.Event();q.type="onBeforeClose";f.trigger(q);if(q.isDefaultPrevented()){return}i=false;b[m.effect][1].call(p,function(){q.type="onClose";f.trigger(q)});c(document).off("click."+l+" keydown."+l);c(window).off("resize scroll",p.putOverlay);if(e){c.mask.close()}return p},getPos:function(){var t={top:m.top,left:m.left},q=j.outerWidth(true),r=j.outerHeight(true);var s=j.data("oSize");if(!s){j.data("oSize",s={width:q,height:r,kx:q/j.width(),ky:r/j.height(),padding:[j.css("padding-top"),j.css("padding-right"),j.css("padding-bottom"),j.css("padding-left")].join(" ")})}if(m.autoFit){if(s.width>o.width()){q=o.width();r=s.height*o.width()/s.width}else{q=s.width;r=s.height}}if(typeof t.top=="string"){t.top=t.top=="center"?Math.max((o.height()-r)/2,0):parseInt(t.top,10)/100*o.height()}if(t.left=="center"){t.left=Math.max((o.width()-q)/2,0)}if(!m.fixed){t.top+=o.scrollTop();t.left+=o.scrollLeft()}if(m.autoFit){if(r<o.height()){t.top=Math.min(t.top,o.height()-r+o.scrollTop())}else{t.top=parseInt(c(j).css("top"))||0;t.top=Math.max(t.top,o.height()-r+o.scrollTop());t.top=Math.min(t.top,o.scrollTop())}t.width=q/s.kx;t.height=r/s.ky;t.oWidth=q;t.oHeight=r;t.padding=n(s.padding,s.width/q,s.height/r)}t.position=m.fixed?"fixed":"absolute";return t},putOverlay:function(){c(j).css(p.getPos())},getOverlay:function(){return j},getTrigger:function(){return h},getClosers:function(){return k},isOpened:function(){return i},getConf:function(){return m}});c.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(r,q){if(c.isFunction(m[q])){c(p).on(q,m[q])}p[q]=function(s){if(s){c(p).on(q,s)}return p}});k=j.find(m.close||".close");if(!k.length&&!m.close){k=c('<a class="close"></a>');j.prepend(k)}k.click(function(q){p.close(q)});if(m.load){p.load()}}c.fn.overlay=function(e){var f=this.data("overlay");if(f){return f}if(c.isFunction(e)){e={onBeforeLoad:e}}e=c.extend(true,{},c.tools.overlay.conf,e);this.each(function(){f=new a(c(this),e);d.push(f);c(this).data("overlay",f)});return e.api?f:this}})(jQuery);
(function(e){var c=e.tools.overlay,a=e(window);e.extend(c.conf,{start:{top:null,left:null},fadeInSpeed:"fast",zIndex:9999});function d(g){var h=g.offset();return{top:h.top+g.height()/2,left:h.left+g.width()/2}}var f=function(s,r){var m=this.getOverlay(),q=this.getConf(),j=this.getTrigger(),t=this,u=s.oWidth,o=m.data("img");var n=m.css("backgroundImage");if(!o){if(!n){throw"background-image CSS property not set for overlay"}if(/url\(/.test(n)){n=n.slice(n.indexOf("(")+1,n.indexOf(")")).replace(/\"/g,"");m.css("backgroundImage","none");o=e('<img src="'+n+'"/>')}else{o=e("<div>")}o.css({border:0,display:"none"}).width(u);e("body").append(o);m.data("img",o)}var l=q.start.top||Math.round(a.height()/2),i=q.start.left||Math.round(a.width()/2);if(j){var h=d(j);l=h.top;i=h.left}if(q.fixed){l-=a.scrollTop();i-=a.scrollLeft()}if(o){o.css({position:"absolute",top:l,left:i,width:0,zIndex:q.zIndex}).show()}m.css(s);function k(){m.css("zIndex",q.zIndex+1).fadeIn(q.fadeInSpeed,function(){if(t.isOpened()&&!e(this).index(m)){r.call()}else{m.hide()}})}if(o){o.animate({top:s.top,left:s.left,width:u},q.speed,k).css("position",s.position)}else{k()}if(o){var g=this.putOverlay;this.putOverlay=function(){g();var p=t.getPos();o.css({top:p.top,left:p.left,width:p.oWidth})}}};var b=function(g){var k=this.getOverlay().hide(),j=this.getConf(),i=this.getTrigger(),h=k.data("img"),l={top:j.start.top,left:j.start.left,width:0};if(i){e.extend(l,d(i))}if(j.fixed&&h){h.css({position:"absolute"}).animate({top:"+="+a.scrollTop(),left:"+="+a.scrollLeft()},0)}if(h){h.animate(l,j.closeSpeed,g)}};c.addEffect("apple",f,b)})(jQuery);
(function(b){b.tools=b.tools||{version:"@VERSION"};var e;e=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};function f(){if(document.all){var k=b(document).height(),j=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,k-j<20?j:k]}return[b(document).width(),b(document).height()]}function h(j){if(j){return j.call(b.mask)}}var i,d,c,a,g;b.mask={load:function(j,l){if(c){return this}if(typeof j=="string"){j={color:j}}j=j||a;a=j=b.extend(b.extend({},e.conf),j);i=b("#"+j.maskId);if(!i.length){i=b("<div/>").attr("id",j.maskId);b("body").append(i)}var k=f();i.css({position:"absolute",top:0,left:0,width:k[0],height:k[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex});if(j.color){i.css("backgroundColor",j.color)}if(h(j.onBeforeLoad)===false){return this}if(j.closeOnEsc){b(document).on("keydown.mask",function(m){if(m.keyCode==27){b.mask.close(m)}})}if(j.closeOnClick){i.on("click.mask",function(m){b.mask.close(m)})}b(window).on("resize.mask",function(){b.mask.fit()});if(l&&l.length){g=l.eq(0).css("zIndex");b.each(l,function(){var m=b(this);if(!/relative|absolute|fixed/i.test(m.css("position"))){m.css("position","relative")}});d=l.css({zIndex:Math.max(j.zIndex+1,g=="auto"?0:g)})}i.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){b.mask.fit();h(j.onLoad);c="full"});c=true;return this},close:function(){if(c){if(h(a.onBeforeClose)===false){return this}i.fadeOut(a.closeSpeed,function(){h(a.onClose);if(d){d.css({zIndex:g})}c=false});b(document).off("keydown.mask");i.off("click.mask");b(window).off("resize.mask")}return this},fit:function(){if(c){var j=f();i.css({width:j[0],height:j[1]})}},getMask:function(){return i},isLoaded:function(j){return j?c=="full":c},getConf:function(){return a},getExposed:function(){return d}};b.fn.mask=function(j){b.mask.load(j);return this};b.fn.expose=function(j){b.mask.load(j,this);return this}})(jQuery);
